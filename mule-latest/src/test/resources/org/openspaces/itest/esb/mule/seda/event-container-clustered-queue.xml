<mule xmlns="http://www.mulesoft.org/schema/mule/core"
       xmlns:os-events="http://www.openspaces.org/schema/events"
       xmlns:os-core="http://www.openspaces.org/schema/core"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:spring="http://www.springframework.org/schema/beans"
       xmlns:os-queue="http://www.openspaces.org/schema/mule/os-queue"
       xmlns:os-seda="http://www.openspaces.org/schema/mule/os-seda"
       xmlns:os-eventcontainer="http://www.openspaces.org/schema/mule/os-eventcontainer"
       xsi:schemaLocation="http://www.openspaces.org/schema/core http://www.openspaces.org/schema/10.0/core/openspaces-core.xsd
           http://www.openspaces.org/schema/events http://www.openspaces.org/schema/10.0/events/openspaces-events.xsd
           http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans-3.1.xsd
           http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/3.3/mule.xsd
           http://www.openspaces.org/schema/mule/os-eventcontainer http://www.openspaces.org/schema/10.0/mule/3.3/mule-os-eventcontainer.xsd
           http://www.openspaces.org/schema/mule/os-queue http://www.openspaces.org/schema/10.0/mule/3.3/mule-os-queue.xsd
           http://www.openspaces.org/schema/mule/os-seda http://www.openspaces.org/schema/10.0/mule/3.3/mule-os-seda.xsd">

    <spring:beans>
    
    	<!-- Create a 2,0 cluster -->
        <os-core:space id="space1" url="/./space?cluster_schema=partitioned-sync2backup&amp;total_members=2,0&amp;id=1" lookup-groups="${user.name}" />        
        <os-core:space id="space2" url="/./space?cluster_schema=partitioned-sync2backup&amp;total_members=2,0&amp;id=2" lookup-groups="${user.name}" />

        <!-- GigaSpace over only one of the partitions -->
        <os-core:giga-space id="gigaSpace" space="space1" />
                
        <!-- Polling container over only one of the partitions -->
        <os-events:polling-container id="dataProcessorPollingEventContainer" giga-space="gigaSpace">
            <os-core:template>
                <spring:bean class="org.openspaces.itest.esb.mule.seda.EventContainerClusteredSedaQueueTest$Data">
                    <spring:property name="processed" value="false"/>
                </spring:bean>
            </os-core:template>
        </os-events:polling-container>
                        
    </spring:beans>

    <os-eventcontainer:connector name="gigaSpacesConnector"/>

     <!-- This connector must be declared in order to inject the Spring application context -->
    <os-queue:connector name="queueConnector" giga-space="gigaSpace"/>

    <os-seda:model name="ProcessingModel">
        <os-seda:service name="Verifier">
            <inbound>
                <os-eventcontainer:inbound-endpoint address="os-eventcontainer://dataProcessorPollingEventContainer"/>
            </inbound>
            <component class="org.openspaces.itest.esb.mule.seda.EventContainerClusteredSedaQueueTest$Verifier"/>
            <outbound>
                <pass-through-router>
                    <os-queue:outbound-endpoint path="queue1"/>
                </pass-through-router>
            </outbound>
        </os-seda:service>
        <os-seda:service name="Processor">
            <inbound>
                <os-queue:inbound-endpoint path="queue1"/>
            </inbound>
            <component class="org.openspaces.itest.esb.mule.seda.EventContainerClusteredSedaQueueTest$Processor"/>
            <outbound>
                <pass-through-router>
                    <os-eventcontainer:outbound-endpoint giga-space="gigaSpace"/>
                </pass-through-router>
            </outbound>
        </os-seda:service>
    </os-seda:model>

</mule>
