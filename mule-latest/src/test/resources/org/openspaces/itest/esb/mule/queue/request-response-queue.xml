<?xml version="1.0" encoding="UTF-8"?>
<mule xmlns="http://www.mulesoft.org/schema/mule/core"
	xmlns:os-events="http://openspaces.gigaspaces.org/schema/events"
	xmlns:os-core="http://openspaces.gigaspaces.org/schema/core" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:spring="http://www.springframework.org/schema/beans"
	xmlns:os-queue="http://openspaces.gigaspaces.org/schema/mule/os-queue"
	xmlns:stdio="http://www.mulesoft.org/schema/mule/stdio"

	xsi:schemaLocation="http://openspaces.gigaspaces.org/schema/core http://openspaces.gigaspaces.org/schema/core/openspaces-core.xsd
       http://openspaces.gigaspaces.org/schema/events http://openspaces.gigaspaces.org/schema/events/openspaces-events.xsd
       http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd
       http://www.mulesoft.org/schema/mule/core http://www.mulesoft.org/schema/mule/core/3.5/mule.xsd
       http://www.mulesoft.org/schema/mule/stdio ttp://www.mulesoft.org/schema/mule/stdio/3.5/mule-stdio.xsd
       http://openspaces.gigaspaces.org/schema/mule/os-queue http://openspaces.gigaspaces.org/schema/10.2/mule/3.5/mule-os-queue.xsd">

	<spring:beans>
		<os-core:space id="space" url="/./space" lookup-groups="${user.name}" />

		<os-core:giga-space id="gigaSpace" space="space" />
	</spring:beans>

	<!-- this connector must be declared ,in order to inject the Spring appliction 
		context -->
	<os-queue:connector name="queueConnector"
		giga-space="gigaSpace" />

	<model>
		<service name="BookingService">
			<inbound>
				<os-queue:inbound-endpoint path="bookingflow.in" exchange-pattern="request-response" />
				<message-properties-transformer>
					<add-message-property key="Header1" value="Val1"/>
				</message-properties-transformer>
			</inbound>
			<component
				class="org.openspaces.itest.esb.mule.queue.EchoeComponentAppender" />
			<outbound >
				<pass-through-router >
					<os-queue:outbound-endpoint path="internal.queue.in" exchange-pattern="request-response" />
					
				</pass-through-router>
				
			</outbound>
		</service>

		<service name="InternalBookingService">
			<inbound>
				<os-queue:inbound-endpoint path="internal.queue.in" exchange-pattern="request-response"/>
				<message-properties-transformer>
					<add-message-property key="Header2" value="Val2"/> 
				</message-properties-transformer>
			</inbound>
			<component
				class="org.openspaces.itest.esb.mule.queue.EchoeComponentAppender" />
			<outbound>
				<pass-through-router>
					<os-queue:outbound-endpoint path="external.queue.in"
						exchange-pattern="request-response" />
				</pass-through-router>
			</outbound>
		</service>
		<service name="ExternalBookingService">
			<inbound>
				<os-queue:inbound-endpoint path="external.queue.in" exchange-pattern="request-response"/>
				<message-properties-transformer>
					<add-message-property key="Header3" value="Val3"/> 
				</message-properties-transformer>
			</inbound>
			<component
				class="org.openspaces.itest.esb.mule.queue.EchoeComponentAppender" />
		</service>
	</model>
	

</mule>
